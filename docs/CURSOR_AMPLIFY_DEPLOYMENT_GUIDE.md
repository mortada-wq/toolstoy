# Cursor + AWS Amplify Deployment Guide

A step-by-step workflow for building apps with Cursor and deploying them to AWS Amplify (frontend and backend). Based on real experience building and deploying a full-stack app from scratch.

---

## Overview

This guide covers three phases:

1. **Build with Cursor** — Use prompts and agents to create your app
2. **Version control** — Push to Git and create a repository
3. **Deploy to Amplify** — Automatic frontend hosting + backend (Auth, API, Lambda)

The goal: a repeatable workflow so new apps can be built and deployed with minimal friction.

---

## Phase 1: Build with Cursor

### 1.1 Start with a Clear Prompt

Write a detailed prompt that describes:

- **What the app does** (product, domain, core features)
- **Tech stack** (React, TypeScript, Vite, Tailwind, etc.)
- **Phases or steps** (e.g., Phase 1: Homepage, Phase 2: Routing, Phase 3: Dashboard, Phase 4: Backend)
- **Design constraints** (colors, fonts, layout rules)
- **Out-of-scope items** (what NOT to build yet)

Example structure:

```
Project: [Name] — [One-line description]
Domain: [yourdomain.com]
Tech: React, TypeScript, Vite, Tailwind

Phase 1 — [Scope]
Phase 2 — [Scope]
Phase 3 — [Scope]
Phase 4 — [Scope: Backend, Auth, API, DB]

Design: [Colors, fonts, buttons]
Do NOT build: [Billing, X, Y]
```

The more precise the prompt, the less back-and-forth you need.

### 1.2 Iterate in Chunks

- Build one phase at a time.
- After each phase, run `npm run build` and fix errors before moving on.
- Use Cursor agents for focused tasks (e.g., "Navbar CSS changes", "AWS Amplify setup").
- Keep the agent context tight — one task per agent when possible.

### 1.3 Project Structure Before Deployment

By the time you deploy, your project should have:

```
project/
├── src/                 # Frontend code
├── amplify/             # Backend definition
│   ├── auth/
│   ├── data/
│   ├── functions/
│   └── backend.ts
├── amplify_outputs.json # Generated by sandbox (do not commit if sensitive)
├── package.json
├── vite.config.ts
├── amplify.yml          # Amplify build config (for hosting)
└── docs/                # Guides, checklists
```

### 1.4 Design Rules to State Up Front

If you care about consistency, add these to your initial prompt:

- **No emojis** — Use outline/rounded SVG icons instead
- **Specific colors/fonts** — e.g., Inter font, #1A1A1A, #F5F5F5
- **Button styles** — Outlined vs filled, 8px radius, etc.

---

## Phase 2: Git and Repository

### 2.1 Initialize Git (if not already)

```bash
cd your-project
git init
git add .
git commit -m "Initial commit: [brief description]"
```

### 2.2 Create Remote Repository

1. Go to GitHub (or GitLab, Bitbucket).
2. Create a new repository (no README, no .gitignore — you already have them).
3. Copy the repository URL.

### 2.3 Push to Remote

```bash
git remote add origin https://github.com/YOUR_USERNAME/YOUR_REPO.git
git branch -M main
git push -u origin main
```

### 2.4 What to Commit vs Ignore

**Commit:**
- All source code (`src/`, `amplify/`)
- Config files (`package.json`, `vite.config.ts`, `amplify.yml`)
- `docs/` (guides, checklists)
- `database/` (schema files, migrations)

**Do NOT commit (add to `.gitignore`):**
- `node_modules/`
- `dist/`
- `amplify_outputs.json` (contains environment-specific URLs — Amplify Hosting regenerates it)
- `.env` or any file with secrets
- `*.log`
- `.amplify/` (local Amplify cache)

### 2.5 Example .gitignore Additions

```
amplify_outputs*
dist/
.amplify/
```

---

## Phase 3: Deploy to AWS Amplify

### 3.1 Prerequisites Checklist

| Step | Command / Action |
|------|------------------|
| Node.js 18+ | `node --version` |
| npm | `npm --version` |
| AWS CLI | `aws --version` |
| AWS credentials | `aws configure` |
| Verify credentials | `aws sts get-caller-identity` |

### 3.2 AWS Credentials Setup

**Option A: IAM User (Recommended)**

1. AWS Console → IAM → Users → Create user (e.g., `amplify-dev`)
2. Attach policy: **AdministratorAccess**
3. Create user → Security credentials → Create access key → CLI
4. Copy Access Key ID and Secret Access Key
5. Run `aws configure` and paste both
6. Region: `us-east-1`, Output: `json`

**Option B: Root User**

- Not recommended — use only for quick tests
- IAM → My security credentials → Access keys → Create access key

### 3.3 Local Backend Deployment (Sandbox)

From project root:

```bash
npm install
npx ampx sandbox --once
```

This will:

- Create/update Cognito User Pool
- Create/update AppSync API and DynamoDB
- Create/update Lambda functions and HTTP API
- Write `amplify_outputs.json`

**First run:** 5–10 minutes depending on resources.

### 3.4 Common Sandbox Errors and Fixes

| Error | Cause | Fix |
|-------|-------|-----|
| "User pool attributes cannot be changed" | Cognito schema changed after pool exists | Type `y` when asked to recreate sandbox (deletes existing users) |
| "Unable to resolve AWS account" | Credentials not configured | Run `aws configure` |
| "account not bootstrapped" | CDK never bootstrapped in region | `npx aws-cdk bootstrap aws://YOUR_ACCOUNT_ID/us-east-1` |
| "Permission denied" | IAM user lacks permissions | Attach AdministratorAccess or required policies |
| "Buffer is not defined" (Lambda) | Missing Node types | `npm install --save-dev @types/node` |

### 3.5 Connect Amplify Hosting to GitHub

1. Go to [AWS Amplify Console](https://console.aws.amazon.com/amplify/)
2. **New app** → **Host web app**
3. Choose **GitHub** → Authorize if needed
4. Select your repository and branch (e.g., `main`)
5. Amplify will auto-detect build settings from `amplify.yml`

### 3.6 amplify.yml (Build Configuration)

Create or ensure this file exists in project root:

```yaml
version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm ci
    build:
      commands:
        - npm run build
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
```

Adjust `baseDirectory` if your build output is different (e.g., `build/` for Create React App).

### 3.7 SPA Redirect (Required for React Router)

In Amplify Console → App → Hosting → Redirects:

- **Source:** `</^[^.]+$|\.(?!(css|gif|ico|jpg|js|png|txt|svg|woff|woff2|ttf|map|json|webp)$)([^.]+$)/>`
- **Target:** `/index.html`
- **Type:** 200 (rewrite)

This ensures direct URLs (e.g., `/dashboard`, `/signin`) work without 404.

### 3.8 Backend in Amplify Hosting

If your app uses `amplify_outputs.json`:

- Amplify Hosting will **inject** the correct backend configuration during build when the app is connected to an Amplify backend.
- Link your app: Amplify Console → App settings → General → Backend environment → Connect to backend.
- Or ensure `amplify_outputs.json` is generated in the build (e.g., by running `npx ampx sandbox --once` in CI, or by storing it as a build secret).

For sandbox development, `amplify_outputs.json` is local; for production, Amplify can associate the hosted app with the same backend.

### 3.9 Automatic Deployments

Once connected to GitHub:

- **Every push to `main`** (or your chosen branch) triggers a new build.
- Build logs are in Amplify Console → App → Build history.
- Failed builds show error details; fix and push again.

---

## Quick Reference: Full Flow for a New App

1. **Cursor:** Write detailed prompt → Build phase by phase → Run `npm run build` often
2. **Git:** `git init` → `git add .` → `git commit` → Create repo on GitHub → `git remote add` → `git push`
3. **AWS:** `aws configure` (with IAM user keys) → `npx ampx sandbox --once`
4. **Amplify Hosting:** New app → Connect GitHub repo → Add `amplify.yml` → Add SPA redirect
5. **Done:** Push to `main` → Auto-deploy

---

## Lessons Learned (From This Project)

- **Cognito attributes are immutable** — Plan `fullname`, `custom:store_url`, etc. in the first auth definition. Changing later requires recreating the User Pool.
- **IAM user > root keys** — Safer and easier to revoke. Create a dedicated `amplify-dev` user.
- **Sandbox vs production** — Sandbox is for development. Production uses the same backend but may need separate Amplify app/env.
- **amplify_outputs.json** — Generated locally by sandbox. For CI/CD, Amplify can provide it, or you generate it in the build pipeline.
- **Icons over emojis** — State "no emojis, use SVG icons" in the prompt to avoid refactors later.

---

## File Checklist Before First Deploy

- [ ] `amplify/backend.ts` defines auth, data, functions
- [ ] `amplify/auth/resource.ts` has final attributes (no changes after first deploy)
- [ ] `amplify.yml` exists and matches your build output
- [ ] `.gitignore` excludes `node_modules`, `dist`, `amplify_outputs.json`
- [ ] `package.json` has correct `build` script
- [ ] No hardcoded secrets in code

---

## Summary

| Phase | Tool | Outcome |
|-------|------|---------|
| Build | Cursor + Prompt | Working frontend + backend code |
| Version | Git + GitHub | Repo with clean history |
| Deploy | AWS CLI + Amplify | Live app + Cognito + API |

Follow this guide for each new app, and you can go from prompt to production in one consistent flow.
